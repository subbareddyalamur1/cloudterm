<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CloudTerm - Architecture & Implementation Guide</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; line-height: 1.6; color: #333; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; }
        .container { max-width: 1200px; margin: 20px auto; padding: 20px; background: white; border-radius: 10px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .header { text-align: center; padding: 40px 0; background: linear-gradient(135deg, #2c3e50, #3498db); color: white; border-radius: 10px; margin-bottom: 30px; }
        .header h1 { font-size: 3em; margin-bottom: 10px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        .section { margin: 40px 0; padding: 30px; background: #fff; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); border-left: 4px solid #3498db; }
        .section h2 { color: #2c3e50; font-size: 2.2em; margin-bottom: 20px; border-bottom: 2px solid #ecf0f1; padding-bottom: 10px; }
        .diagram { background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0; font-family: monospace; overflow-x: auto; border: 1px solid #dee2e6; }
        .code-block { background: #2c3e50; color: #ecf0f1; padding: 20px; border-radius: 8px; margin: 15px 0; overflow-x: auto; font-family: monospace; }
        .component-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin: 20px 0; }
        .component-card { background: #fff; border: 1px solid #dee2e6; border-radius: 8px; padding: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .flow-step { background: #e8f4fd; border-left: 4px solid #3498db; padding: 15px; margin: 10px 0; border-radius: 0 8px 8px 0; }
        .tech-stack { display: flex; flex-wrap: wrap; gap: 10px; margin: 15px 0; }
        .tech-item { background: #3498db; color: white; padding: 8px 15px; border-radius: 20px; font-size: 0.9em; font-weight: 500; }
        .enhancement-item { background: #fff3cd; border: 1px solid #ffeaa7; padding: 15px; margin: 10px 0; border-radius: 8px; border-left: 4px solid #f39c12; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🚀 CloudTerm</h1>
            <p>Architecture & Implementation Guide</p>
        </div>

        <div class="section">
            <h2>🎯 System Overview</h2>
            <p>CloudTerm is a modern web-based terminal application designed to revolutionize AWS EC2 instance management through automatic discovery, intelligent organization, and secure terminal access.</p>
            
            <h3>Core Architecture</h3>
            <div class="diagram">
<pre>
┌─────────────────────────────────────────────────────────────────┐
│                        CloudTerm Architecture                   │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────┐    ┌──────────────┐    ┌─────────────────┐    │
│  │   Browser   │◄──►│  CloudTerm   │◄──►│   AWS Services  │    │
│  │             │    │   Web App    │    │                 │    │
│  │ - XtermJS   │    │              │    │ - EC2           │    │
│  │ - WebSocket │    │ - Flask      │    │ - Session Mgr   │    │
│  │ - Search UI │    │ - SocketIO   │    │ - STS           │    │
│  └─────────────┘    │ - Boto3      │    └─────────────────┘    │
│                     └──────────────┘                           │
└─────────────────────────────────────────────────────────────────┘
</pre>
            </div>

            <h3>Technology Stack</h3>
            <div class="tech-stack">
                <span class="tech-item">Python 3.11</span>
                <span class="tech-item">Flask</span>
                <span class="tech-item">Flask-SocketIO</span>
                <span class="tech-item">Boto3</span>
                <span class="tech-item">XtermJS</span>
                <span class="tech-item">AWS Session Manager</span>
                <span class="tech-item">Docker</span>
            </div>
        </div>

        <div class="section">
            <h2>🏗️ Core Components</h2>
            
            <div class="component-grid">
                <div class="component-card">
                    <h4>🌐 Web Interface</h4>
                    <p><strong>File:</strong> templates/index.html</p>
                    <p><strong>Purpose:</strong> Main UI with instance tree, search, and terminal</p>
                    <p><strong>Features:</strong> Hierarchical tree view, real-time search, XtermJS terminal</p>
                </div>
                <div class="component-card">
                    <h4>🐍 Flask Application</h4>
                    <p><strong>File:</strong> app.py</p>
                    <p><strong>Purpose:</strong> Main server handling HTTP/WebSocket requests</p>
                    <p><strong>Features:</strong> AWS integration, instance management, session handling</p>
                </div>
                <div class="component-card">
                    <h4>☁️ AWS Integration</h4>
                    <p><strong>Service:</strong> Boto3 SDK</p>
                    <p><strong>Purpose:</strong> Interface with EC2, STS, Session Manager</p>
                    <p><strong>Features:</strong> Multi-account support, instance discovery, secure connections</p>
                </div>
                <div class="component-card">
                    <h4>🔍 Search Engine</h4>
                    <p><strong>Implementation:</strong> Client-side JavaScript</p>
                    <p><strong>Purpose:</strong> Real-time filtering across hierarchy</p>
                    <p><strong>Features:</strong> Multi-level search, auto-expansion, fuzzy matching</p>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>🔄 Data Flow & Execution</h2>
            
            <h3>Application Startup</h3>
            <div class="flow-step">
                <strong>1. Initialization:</strong> Flask app starts, loads config, initializes SocketIO
            </div>
            <div class="flow-step">
                <strong>2. Web Load:</strong> Browser loads UI, establishes WebSocket connection
            </div>
            <div class="flow-step">
                <strong>3. Auto-Scan:</strong> Frontend automatically triggers instance discovery
            </div>
            <div class="flow-step">
                <strong>4. Organization:</strong> Instances organized in 4-level hierarchy
            </div>

            <h3>Instance Discovery Process</h3>
            <div class="code-block">
<pre>
def fetch_ec2_instances(aws_profile, aws_region, tag1_name, tag2_name):
    """Fetch EC2 instances from AWS with metadata"""
    session = boto3.Session(profile_name=aws_profile, region_name=aws_region)
    ec2 = session.client('ec2')
    sts = session.client('sts')
    
    # Get account ID
    account_info = sts.get_caller_identity()
    account_id = account_info['Account']
    
    # Fetch instances
    response = ec2.describe_instances()
    instances = []
    
    for reservation in response['Reservations']:
        for instance in reservation['Instances']:
            tags = {tag['Key']: tag['Value'] for tag in instance.get('Tags', [])}
            instance_data = {
                'instance_id': instance['InstanceId'],
                'name': tags.get('Name', instance['InstanceId']),
                'state': instance['State']['Name'],
                'platform': instance.get('Platform', 'linux'),
                'aws_profile': aws_profile,
                'region': aws_region,
                'account_id': account_id,
                'tags': tags,
                tag1_name.lower(): tags.get(tag1_name, 'Unknown'),
                tag2_name.lower(): tags.get(tag2_name, 'Unknown')
            }
            instances.append(instance_data)
    
    return instances
</pre>
            </div>

            <h3>4-Level Hierarchy Organization</h3>
            <div class="diagram">
<pre>
Level 1: AWS Account (123456789012)
    │
    ├── Level 2: Region (us-east-1)
    │   │
    │   ├── Level 3: Customer/TAG1 (ACME Corp)
    │   │   │
    │   │   ├── Level 4: Environment/TAG2 (production)
    │   │   │   ├── 🖥️ Web Server 1 (i-1234567890abcdef0)
    │   │   │   └── 🖥️ Database Server (i-0987654321fedcba0)
    │   │   │
    │   │   └── Level 4: Environment/TAG2 (development)
    │   │       └── 🖥️ Dev Server (i-1111222233334444)
</pre>
            </div>
        </div>

        <div class="section">
            <h2>🔐 Security Model</h2>
            
            <h3>Security Principles</h3>
            <div class="component-grid">
                <div class="component-card">
                    <h4>🛡️ AWS Session Manager</h4>
                    <p>Uses AWS Session Manager for secure terminal connections without SSH keys or open ports</p>
                </div>
                <div class="component-card">
                    <h4>🔑 IAM-Based Access</h4>
                    <p>Leverages AWS IAM roles and policies for fine-grained access control</p>
                </div>
                <div class="component-card">
                    <h4>🏠 Credential Isolation</h4>
                    <p>AWS credentials mounted from host system, not stored in container</p>
                </div>
                <div class="component-card">
                    <h4>👤 Non-Root Container</h4>
                    <p>Application runs as unprivileged user in Docker container</p>
                </div>
            </div>

            <h3>Required AWS Permissions</h3>
            <div class="code-block">
<pre>
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "ec2:DescribeInstances",
        "ssm:StartSession",
        "ssm:TerminateSession", 
        "ssm:ResumeSession",
        "ssm:DescribeSessions",
        "sts:GetCallerIdentity"
      ],
      "Resource": "*"
    }
  ]
}
</pre>
            </div>
        </div>

        <div class="section">
            <h2>📈 Future Enhancements</h2>
            
            <div class="enhancement-item">
                <h4>🔄 Real-Time Instance Monitoring</h4>
                <p>Add real-time instance state monitoring with WebSocket updates for state changes, CPU/memory metrics, and automated alerts.</p>
            </div>
            
            <div class="enhancement-item">
                <h4>👥 Multi-User Support</h4>
                <p>Implement user authentication, role-based access control, and session management for team environments.</p>
            </div>
            
            <div class="enhancement-item">
                <h4>📊 Analytics Dashboard</h4>
                <p>Add usage analytics, cost tracking, instance utilization metrics, and reporting capabilities.</p>
            </div>
            
            <div class="enhancement-item">
                <h4>🔧 Instance Management</h4>
                <p>Enable start/stop/restart operations, bulk actions, and automated scheduling through the web interface.</p>
            </div>
            
            <div class="enhancement-item">
                <h4>🌐 Multi-Cloud Support</h4>
                <p>Extend support to Azure VMs, Google Cloud Compute instances, and hybrid cloud environments.</p>
            </div>
            
            <div class="enhancement-item">
                <h4>🔍 Advanced Search</h4>
                <p>Add saved searches, complex filtering, regex support, and search history functionality.</p>
            </div>
        </div>

        <div class="section">
            <h2>🛠️ Deployment Architecture</h2>
            
            <h3>Container Architecture</h3>
            <div class="diagram">
<pre>
Docker Container Structure:

┌─────────────────────────────────────────┐
│            CloudTerm Container          │
├─────────────────────────────────────────┤
│  ┌─────────────────────────────────────┐ │
│  │         Application Layer           │ │
│  │  - Flask App (app.py)              │ │
│  │  - Templates (index.html)          │ │
│  │  - Static Assets (JS/CSS)          │ │
│  └─────────────────────────────────────┘ │
│  ┌─────────────────────────────────────┐ │
│  │         Runtime Layer               │ │
│  │  - Python 3.11 Virtual Environment │ │
│  │  - AWS Session Manager Plugin      │ │
│  │  - System Dependencies             │ │
│  └─────────────────────────────────────┘ │
│  ┌─────────────────────────────────────┐ │
│  │         Base Layer                  │ │
│  │  - Ubuntu 22.04 LTS                │ │
│  │  - Non-root user (appuser)         │ │
│  └─────────────────────────────────────┘ │
└─────────────────────────────────────────┘

Volume Mounts:
- ~/.aws:/home/appuser/.aws:ro (AWS credentials)
- ./instances_list.yaml:/app/instances_list.yaml:rw (Config)

Environment Variables:
- TAG1=Customer (Configurable grouping)
- TAG2=Environment (Configurable grouping)
- AWS_DEFAULT_REGION=us-east-1
</pre>
            </div>
        </div>

        <div class="section">
            <h2>📊 Performance Considerations</h2>
            
            <h3>Optimization Strategies</h3>
            <div class="component-grid">
                <div class="component-card">
                    <h4>⚡ Client-Side Processing</h4>
                    <p>Search and filtering performed on client-side to reduce server load and provide real-time response</p>
                </div>
                <div class="component-card">
                    <h4>🔄 Efficient AWS API Usage</h4>
                    <p>Batched API calls, pagination handling, and error retry mechanisms for reliable AWS integration</p>
                </div>
                <div class="component-card">
                    <h4>💾 Memory Management</h4>
                    <p>Container resource limits (512MB memory, 0.5 CPU) and efficient data structures for scalability</p>
                </div>
                <div class="component-card">
                    <h4>🌐 WebSocket Efficiency</h4>
                    <p>Persistent connections for terminal sessions with automatic cleanup and connection pooling</p>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>🔧 Troubleshooting Guide</h2>
            
            <h3>Common Issues & Solutions</h3>
            <div class="code-block">
<pre>
Issue: No instances found
Solution: 
- Check AWS credentials configuration
- Verify IAM permissions
- Ensure instances have required tags

Issue: Scan fails
Solution:
- Verify Session Manager is enabled on instances
- Check VPC endpoints configuration
- Review CloudTrail logs for API errors

Issue: Connection timeout
Solution:
- Check security groups allow Session Manager
- Verify VPC has internet gateway or NAT
- Ensure instances have SSM agent installed

Issue: Static files not loading (404 errors)
Solution:
- Rebuild Docker image with static/ directory
- Check Dockerfile COPY commands
- Verify file permissions in container
</pre>
            </div>
        </div>
    </div>
</body>
</html>
